<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ããè€³ãšãã‚“</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #fff;
            color: #333;
            line-height: 1.6;
        }
        header {
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }
        .intro-section {
            margin: 20px 0;
        }
        /* ã‚¤ãƒ©ã‚¹ãƒˆã¯å·¦å³ã®ä½™ç™½ãªã— */
        .intro-img {
            width: calc(100% + 3rem);
            margin-left: -1.5rem;
            height: 200px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            object-fit: cover;
        }
        .intro-text {
            white-space: pre-wrap;
            margin-top: 20px;
            font-size: 0.95rem;
        }
        .action-area {
            text-align: center;
            margin: 10px 0; /* ä¸Šä¸‹ã‚’è©°ã‚ãŸ */
        }
        .main-btn {
            padding: 12px 24px;
            font-size: 1rem;
            background: #333;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .section-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 20px 0 10px;
        }
        .post-card {
            border: 1px solid #eee;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: #fff;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            border-radius: 8px;
        }
        #map { height: 200px; margin: 10px 0; }
        .map-btns { display: flex; gap: 10px; margin-bottom: 10px; }
        
        /* ã‚¹ãƒãƒ›ã§ãƒœã‚¿ãƒ³ã‚’ç¸¦2è¡Œã« */
        @media (max-width: 480px) {
            .map-btns { flex-direction: column; }
        }
        
        .small-btn {
            flex: 1;
            padding: 8px;
            border: 1px solid #ccc;
            background: #fff;
            cursor: pointer;
        }
        .hidden { display: none; }
    </style>
</head>
<body>

<header>
    <div style="font-weight:bold;">ããè€³ãšãã‚“</div>
    <button onclick="toggleView()" id="nav-btn">ãƒã‚¤ãƒšãƒ¼ã‚¸</button>
</header>

<div class="container" id="main-view">
    <div class="intro-section">
        <div class="intro-img">ã‚¤ãƒ©ã‚¹ãƒˆ</div>
        <div class="intro-text">ããè€³ãšãã‚“ã‚’ã‹ã¶ã‚‹ã¨ã€è¡—ãŒå°‘ã—ã‚„ã•ã—ããªã‚‹ã€‚
ã„ã¤ã‚‚é€šã£ã¦ã„ã‚‹é“ã®ã¯ãšãªã®ã«ã€
æ©‹ã®ãŸã‚‚ã¨ã‚„æ± ã®ãã°ã€åã‚‚ãªã„å ´æ‰€ã‹ã‚‰ã€
å°ã•ãªå£°ãŒèã“ãˆã¦ãã‚‹ã€‚

ç«‹æœ­ã«æ›¸ã‹ã‚ŒãŸæ˜”ã®è©±ã‚„ã€å¿˜ã‚Œã‚‰ã‚Œã‹ã‘ãŸå‡ºæ¥äº‹ã€‚
ãã‚Œã‚’èª­ã‚“ã§ã€å¿ƒã«æ®‹ã£ãŸã“ã¨ã‚’ã€
è‡ªåˆ†ã®è¨€è‘‰ã«ã—ã¦ãã£ã¨ç½®ã„ã¦ã„ãã€‚
èª°ã‹ã«å±Šã‘ã‚‹ã¨ã„ã†ã‚ˆã‚Šã€è¡—ã«è¿”ã™ã‚ˆã†ãªæ°—æŒã¡ã§ã€‚

ããè€³ãšãã‚“ã®ä¸­ã«ã¯ã€é™ã‹ã§ã€ã‚ãŸãŸã‹ã„ä¸–ç•ŒãŒåºƒãŒã£ã¦ã„ã‚‹ã€‚</div>
    </div>

    <div class="action-area">
        <button class="main-btn" onclick="openModal()">ããè€³ã‚’æ®‹ã™</button>
    </div>

    <div class="section-title">ããè€³ã‚’ãŸã¦ã‚‹</div>

    <div id="post-list"></div>
</div>

<div class="container hidden" id="mypage-view">
    <div class="section-title">è‡ªåˆ†ã®ããè€³</div>
    <div id="my-post-list"></div>
</div>

<div class="modal" id="post-modal">
    <div class="modal-content">
        <h3>ä»Šã®ããè€³ã‚’ç¶´ã‚‹</h3>
        <div class="map-btns">
            <button class="small-btn" onclick="setCurrentLocation()">ç¾åœ¨åœ°ã‹ã‚‰</button>
            <button class="small-btn" onclick="alert('æ¤œç´¢æ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™')">å ´æ‰€æ¤œç´¢ã‹ã‚‰ãƒ”ãƒ³ã‚’ç«‹ã¦ã‚‹</button>
        </div>
        <div id="map"></div>
        <input type="text" id="loc-name" placeholder="å ´æ‰€ã®åå‰" style="width:100%; margin:10px 0; padding:8px; box-sizing:border-box;">
        <textarea id="post-body" placeholder="å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" style="width:100%; height:80px; padding:8px; box-sizing:border-box;"></textarea>
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button onclick="closeModal()" style="flex:1;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button onclick="savePost()" style="flex:1; background:#333; color:#fff; border:none;">ãã£ã¨ç½®ã„ã¦ã„ã</button>
        </div>
    </div>
</div>

<script>
    let map, marker;
    let currentCoords = [35.6812, 139.7671];
    let posts = JSON.parse(localStorage.getItem('kikimimi_data') || '[]');

    function initMap() {
        map = L.map('map').setView(currentCoords, 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        marker = L.marker(currentCoords, {draggable: true}).addTo(map);
        map.on('click', e => {
            marker.setLatLng(e.latlng);
            currentCoords = [e.latlng.lat, e.latlng.lng];
        });
    }

    function openModal() {
        document.getElementById('post-modal').style.display = 'flex';
        if (!map) { setTimeout(initMap, 100); }
    }

    function closeModal() {
        document.getElementById('post-modal').style.display = 'none';
    }

    function setCurrentLocation() {
        navigator.geolocation.getCurrentPosition(p => {
            currentCoords = [p.coords.latitude, p.coords.longitude];
            map.setView(currentCoords, 15);
            marker.setLatLng(currentCoords);
        });
    }

    function savePost() {
        const text = document.getElementById('post-body').value;
        const loc = document.getElementById('loc-name').value || 'åã‚‚ãªã„å ´æ‰€';
        if (!text) return;

        posts.unshift({
            id: Date.now(),
            text,
            loc,
            coords: currentCoords,
            date: new Date().toLocaleString()
        });
        localStorage.setItem('kikimimi_data', JSON.stringify(posts));
        location.reload();
    }

    function render() {
        const list = document.getElementById('post-list');
        const myList = document.getElementById('my-post-list');
        posts.forEach(p => {
            const html = `<div class="post-card">
                <div style="font-size:0.8rem; color:#888;">${p.date}</div>
                <div style="font-weight:bold; margin:5px 0;">ğŸ“ ${p.loc}</div>
                <div>${p.text}</div>
            </div>`;
            list.innerHTML += html;
            myList.innerHTML += html;
        });
    }

    function toggleView() {
        const isMain = !document.getElementById('main-view').classList.contains('hidden');
        document.getElementById('main-view').classList.toggle('hidden');
        document.getElementById('mypage-view').classList.toggle('hidden');
        document.getElementById('nav-btn').innerText = isMain ? 'ã‚‚ã©ã‚‹' : 'ãƒã‚¤ãƒšãƒ¼ã‚¸';
    }

    render();
</script>
</body>
</html>
